# π― sight-spring-backend ν”„λ΅μ νΈ μ–΄λ…Έν…μ΄μ… μ™„λ²½ κ°€μ΄λ“

## 1οΈβƒ£ **Spring Core μ–΄λ…Έν…μ΄μ…** (μμ΅΄μ„± μ£Όμ… & λΉ κ΄€λ¦¬)

### `@SpringBootApplication`
- **μ„μΉ**: λ©”μΈ ν΄λμ¤
- **μ—­ν• **: Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ μ‹μ‘μ  ν‘μ‹
- **ν¬ν•¨ν•λ” μ–΄λ…Έν…μ΄μ…**: `@Configuration`, `@EnableAutoConfiguration`, `@ComponentScan`
- **μ‚¬μ© μμ‹**: `SightSpringBackendApplication.kt`

### `@Component`
- **μ—­ν• **: Springμ΄ κ΄€λ¦¬ν•λ” λ²”μ© λΉ(Bean)μΌλ΅ λ“±λ΅
- **μ‚¬μ© μμ‹**: `JdaDiscordApiAdapter`, `AuthAspect`, `UserDiscordEventController`

### `@Service`
- **μ—­ν• **: λΉ„μ¦λ‹μ¤ λ΅μ§μ„ λ‹΄λ‹Ήν•λ” μ„λΉ„μ¤ κ³„μΈµ λΉ
- **μ‚¬μ© μμ‹**: `UserService`, `DiscordRoleService`, `TransactionService`

### `@Repository`
- **μ—­ν• **: λ°μ΄ν„°λ² μ΄μ¤ μ ‘κ·Όμ„ λ‹΄λ‹Ήν•λ” λ¦¬ν¬μ§€ν† λ¦¬ κ³„μΈµ λΉ
- **μ‚¬μ© μμ‹**: `MemberRepository`, `DiscordIntegrationRepository`, `GroupMemberRepository`

### `@Configuration`
- **μ—­ν• **: μ„¤μ • ν΄λμ¤μ„μ„ ν‘μ‹, Bean μ •μλ¥Ό ν¬ν•¨
- **μ‚¬μ© μμ‹**: `SecurityConfig`, `WebConfig`

### `@Bean`
- **μ—­ν• **: λ©”μ„λ“κ°€ Spring Containerμ—μ„ κ΄€λ¦¬ν•λ” λΉ κ°μ²΄λ¥Ό λ°ν™ν•¨μ„ ν‘μ‹
- **μ‚¬μ© μμ‹**: `SecurityConfig`μ `restTemplate()`, `filterChain()`

---

## 2οΈβƒ£ **Spring Web (REST API) μ–΄λ…Έν…μ΄μ…**

### `@RestController`
- **μ—­ν• **: REST API μ»¨νΈλ΅¤λ¬μ„μ„ ν‘μ‹ (`@Controller` + `@ResponseBody`)
- **μ‚¬μ© μμ‹**: `UserController`, `GroupController`, `PingController`

### `@GetMapping`
- **μ—­ν• **: HTTP GET μ”μ²­μ„ μ²λ¦¬ν•λ” λ©”μ„λ“ λ§¤ν•‘
- **μ‚¬μ© μμ‹**: `@GetMapping("/users/@me")`

### `@PostMapping`
- **μ—­ν• **: HTTP POST μ”μ²­μ„ μ²λ¦¬ν•λ” λ©”μ„λ“ λ§¤ν•‘
- **μ‚¬μ© μμ‹**: `@PostMapping("/users/@me/discord-integration/issue-url")`

### `@DeleteMapping`
- **μ—­ν• **: HTTP DELETE μ”μ²­μ„ μ²λ¦¬ν•λ” λ©”μ„λ“ λ§¤ν•‘
- **μ‚¬μ© μμ‹**: `@DeleteMapping("/users/@me/discord-integration")`

### `@ModelAttribute`
- **μ—­ν• **: HTTP μ”μ²­ νλΌλ―Έν„°λ¥Ό κ°μ²΄λ΅ λ°”μΈλ”©
- **μ‚¬μ© μμ‹**: `callbackDiscordIntegration(...@ModelAttribute request: ...)`

### `@RequestBody`
- **μ—­ν• **: HTTP μ”μ²­ λ³Έλ¬Έ(JSON)μ„ κ°μ²΄λ΅ λ°”μΈλ”©
- **μ‚¬μ© μμ‹**: `@RequestBody request: CreateTransactionRequest`

### `@RequestParam`
- **μ—­ν• **: HTTP μΏΌλ¦¬ νλΌλ―Έν„°λ¥Ό λ©”μ„λ“ νλΌλ―Έν„°λ΅ λ°”μΈλ”©
- **μ‚¬μ© μμ‹**: `@RequestParam year: Int`

### `@PathVariable`
- **μ—­ν• **: URL κ²½λ΅μ λ³€μλ¥Ό λ©”μ„λ“ νλΌλ―Έν„°λ΅ λ°”μΈλ”©
- **μ‚¬μ© μμ‹**: `@PathVariable id: String` (URL: `/transactions/{id}`)

### `@ResponseStatus`
- **μ—­ν• **: HTTP μ‘λ‹µ μƒνƒ μ½”λ“ μ§€μ •
- **μ‚¬μ© μμ‹**: `@ResponseStatus(HttpStatus.CREATED)` β†’ 201 μ‘λ‹µ

### `@ControllerAdvice`
- **μ—­ν• **: μ „μ—­ μμ™Έ μ²λ¦¬ ν•Έλ“¤λ¬
- **μ‚¬μ© μμ‹**: `GlobalExceptionHandler`

### `@ExceptionHandler`
- **μ—­ν• **: νΉμ • μμ™Έλ¥Ό μ²λ¦¬ν•λ” λ©”μ„λ“ ν‘μ‹
- **μ‚¬μ© μμ‹**: `@ExceptionHandler(BaseException::class)`

---

## 3οΈβƒ£ **JPA (λ°μ΄ν„°λ² μ΄μ¤ λ§¤ν•‘) μ–΄λ…Έν…μ΄μ…**

### `@Entity`
- **μ—­ν• **: μ΄ ν΄λμ¤κ°€ λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”κ³Ό λ§¤ν•‘λλ” JPA μ—”ν‹°ν‹°μ„μ„ μ„ μ–Έ
- **μ‚¬μ© μμ‹**: `Member`, `Group`, `Transaction`, `DiscordRole`

### `@Table`
- **μ—­ν• **: μ—”ν‹°ν‹°μ™€ λ§¤ν•‘λ  ν…μ΄λΈ” μ΄λ¦„κ³Ό μ†μ„± μ§€μ •
- **μ‚¬μ© μμ‹**: `@Table(name = "khlug_members")`

### `@Id`
- **μ—­ν• **: μ—”ν‹°ν‹°μ Primary Key ν•„λ“ μ§€μ •
- **μ‚¬μ© μμ‹**: `Member`μ `id` ν•„λ“

### `@Column`
- **μ—­ν• **: ν•„λ“μ™€ λ°μ΄ν„°λ² μ΄μ¤ μ»¬λΌ λ§¤ν•‘ λ° μ†μ„± μ„¤μ •
- **μ†μ„±**: 
  - `name`: μ»¬λΌ μ΄λ¦„
  - `nullable`: null ν—μ© μ—¬λ¶€
  - `unique`: κ³ μ κ°’ μ μ•½μ΅°κ±΄
  - `length`: λ¬Έμμ—΄ κΈΈμ΄
  - `columnDefinition`: μ»¬λΌ μ •μ μ§μ ‘ μ§€μ •
- **μ‚¬μ© μμ‹**: `@Column(name = "name", unique = true, nullable = false, length = 127)`

### `@Convert`
- **μ—­ν• **: JPA AttributeConverterλ¥Ό μ‚¬μ©ν•΄ μ»¤μ¤ν…€ νƒ€μ… λ³€ν™
- **μ‚¬μ© μμ‹**: `@Convert(converter = StudentStatusConverter::class)`

### `@Converter`
- **μ—­ν• **: JPA AttributeConverter ν΄λμ¤μ„μ„ ν‘μ‹
- **μ‚¬μ© μμ‹**: `StudentStatusConverter`, `UserStatusConverter`

---

## 4οΈβƒ£ **Hibernate μ „μ© μ–΄λ…Έν…μ΄μ…**

### `@CreationTimestamp`
- **μ—­ν• **: μ—”ν‹°ν‹° μƒμ„± μ‹ μλ™μΌλ΅ ν„μ¬ μ‹κ°„μ„ μ„¤μ •
- **μ‚¬μ© μμ‹**: `Group`μ `createdAt` ν•„λ“

### `@UpdateTimestamp`
- **μ—­ν• **: μ—”ν‹°ν‹° μμ • μ‹ μλ™μΌλ΅ ν„μ¬ μ‹κ°„μ„ μ—…λ°μ΄νΈ
- **μ‚¬μ© μμ‹**: `Group`μ `updatedAt` ν•„λ“

### `@ColumnDefault`
- **μ—­ν• **: λ°μ΄ν„°λ² μ΄μ¤ μ»¬λΌμ κΈ°λ³Έκ°’ μ§€μ •
- **μ‚¬μ© μμ‹**: `@ColumnDefault("0")`

---

## 5οΈβƒ£ **Spring Security μ–΄λ…Έν…μ΄μ…**

### `@EnableWebSecurity`
- **μ—­ν• **: Spring Security μ„¤μ • ν™μ„±ν™”
- **μ‚¬μ© μμ‹**: `SecurityConfig`

### `@EnableMethodSecurity`
- **μ—­ν• **: λ©”μ„λ“ μμ¤€ λ³΄μ• ν™μ„±ν™” (prePostEnabled: `@PreAuthorize`, `@PostAuthorize` μ‚¬μ© κ°€λ¥)
- **μ‚¬μ© μμ‹**: `SecurityConfig`

---

## 6οΈβƒ£ **AOP (Aspect-Oriented Programming) μ–΄λ…Έν…μ΄μ…**

### `@Aspect`
- **μ—­ν• **: AOP Aspect ν΄λμ¤λ¥Ό μ •μ
- **μ‚¬μ© μμ‹**: `AuthAspect`

### `@Around`
- **μ—­ν• **: λ©”μ„λ“ μ‹¤ν–‰ μ „ν›„μ— μ½”λ“ μ‹¤ν–‰ (κ°€μ¥ κ°•λ ¥ν• Advice)
- **μ‚¬μ© μμ‹**: `@Around("@annotation(auth)")`

### `@EnableAspectJAutoProxy`
- **μ—­ν• **: AspectJ κΈ°λ° AOP ν”„λ΅μ‹ μλ™ μƒμ„± ν™μ„±ν™”
- **μ‚¬μ© μμ‹**: `SecurityConfig`

---

## 7οΈβƒ£ **Validation μ–΄λ…Έν…μ΄μ…**

### `@Valid`
- **μ—­ν• **: λ©”μ„λ“ νλΌλ―Έν„°λ‚ κ°μ²΄μ— λ€ν• μ ν¨μ„± κ²€μ¦ μ‹¤ν–‰
- **μ‚¬μ© μμ‹**: `callbackDiscordIntegration(@Valid @ModelAttribute request: ...)`

### `@NotBlank`
- **μ—­ν• **: null, λΉ λ¬Έμμ—΄(`""`), κ³µλ°±λ§ μλ” λ¬Έμμ—΄(`"   "`) λ¨λ‘ κ²€μ¦
- **μ‚¬μ© μμ‹**: `@field:NotBlank(message = "κ΄€μ‹¬λ¶„μ•Ό μ΄λ¦„μ€ ν•„μμ…λ‹λ‹¤")`

### `@NotNull`
- **μ—­ν• **: null κ°’λ§ μ²΄ν¬
- **μ‚¬μ© μμ‹**: ν•„λ“κ°€ nullμ΄ μ•„λ‹μ–΄μ•Ό ν•  λ•

### `@NotEmpty`
- **μ—­ν• **: nullκ³Ό λΉ μ»¬λ ‰μ…/λ¬Έμμ—΄ μ²΄ν¬
- **μ‚¬μ© μμ‹**: λ¦¬μ¤νΈλ‚ λ¬Έμμ—΄μ΄ λΉ„μ–΄μμ§€ μ•μ•„μ•Ό ν•  λ•

### `@Min`
- **μ—­ν• **: μµμ†κ°’ κ²€μ¦
- **μ‚¬μ© μμ‹**: `@Min(value = 0, message = "κ°€κ²©μ€ 0 μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤")`

### `@Max`
- **μ—­ν• **: μµλ€κ°’ κ²€μ¦
- **μ‚¬μ© μμ‹**: `@Max(50, message = "limitμ€ μµλ€ 50μ…λ‹λ‹¤")`

### `@Validated`
- **μ—­ν• **: ν΄λμ¤ λ λ²¨μ—μ„ validation ν™μ„±ν™”
- **μ‚¬μ© μμ‹**: `TransactionController`

---

## 8οΈβƒ£ **μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ…** (ν”„λ΅μ νΈ μμ²΄ μ •μ)

### `@Auth`
- **μ—­ν• **: μΈμ¦/μΈκ°€ κ²€μ‚¬λ¥Ό μν–‰ν•λ” μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ…
- **μ†μ„±**: `roles` - ν—μ©ν•  μ‚¬μ©μ μ—­ν•  λ°°μ—΄
- **μ‚¬μ© μμ‹**: `@Auth([UserRole.USER, UserRole.MANAGER])`
- **κµ¬ν„**: `AuthAspect`μ—μ„ AOPλ΅ μ²λ¦¬

### `@DiscordEventListener`
- **μ—­ν• **: Discord μ΄λ²¤νΈ λ¦¬μ¤λ„μ„μ„ ν‘μ‹ν•λ” μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ…
- **μ‚¬μ© μμ‹**: `UserDiscordEventController`

### μ–΄λ…Έν…μ΄μ… μ •μμ— μ‚¬μ©λλ” λ©”νƒ€ μ–΄λ…Έν…μ΄μ…:

#### `@Target`
- **μ—­ν• **: μ–΄λ…Έν…μ΄μ…μ„ μ–΄λ””μ— μ‚¬μ©ν•  μ μλ”μ§€ μ§€μ •
- **μμ‹**: `@Target(AnnotationTarget.FUNCTION, AnnotationTarget.CLASS)`

#### `@Retention`
- **μ—­ν• **: μ–΄λ…Έν…μ΄μ… μ •λ³΄λ¥Ό μ–Έμ κΉμ§€ μ μ§€ν• μ§€ μ§€μ •
- **μμ‹**: `@Retention(AnnotationRetention.RUNTIME)` - λ°νƒ€μ„μ—λ„ μ μ§€

---

## 9οΈβƒ£ **Transaction μ–΄λ…Έν…μ΄μ…**

### `@Transactional`
- **μ—­ν• **: λ©”μ„λ“λ¥Ό λ°μ΄ν„°λ² μ΄μ¤ νΈλμ­μ…μΌλ΅ κ°μ‹ΈκΈ°
- **μ†μ„±**: 
  - `readOnly = true`: μ½κΈ° μ „μ© νΈλμ­μ… (μ„±λ¥ μµμ ν™”)
- **μ‚¬μ© μμ‹**: `TransactionService`μ `createTransaction()`

---

## π” **JSON μ–΄λ…Έν…μ΄μ…**

### `@JsonProperty`
- **μ—­ν• **: JSON ν•„λ“λ…κ³Ό Kotlin ν”„λ΅νΌν‹°λ… λ§¤ν•‘
- **μ‚¬μ© μμ‹**: `@field:JsonProperty("fieldName")`

---

## π“ **μΉ΄ν…κ³ λ¦¬λ³„ μ”μ•½ν‘**

| μΉ΄ν…κ³ λ¦¬ | μ–΄λ…Έν…μ΄μ… μ | μ£Όμ” μ–΄λ…Έν…μ΄μ… |
|---------|------------|--------------|
| **Spring Core** | 6κ° | `@Component`, `@Service`, `@Repository`, `@Configuration` |
| **Spring Web** | 10κ° | `@RestController`, `@GetMapping`, `@PostMapping`, `@RequestBody` |
| **JPA** | 6κ° | `@Entity`, `@Table`, `@Id`, `@Column` |
| **Hibernate** | 3κ° | `@CreationTimestamp`, `@UpdateTimestamp` |
| **Spring Security** | 2κ° | `@EnableWebSecurity`, `@EnableMethodSecurity` |
| **AOP** | 3κ° | `@Aspect`, `@Around` |
| **Validation** | 7κ° | `@Valid`, `@NotBlank`, `@Min`, `@Max` |
| **μ»¤μ¤ν…€** | 2κ° | `@Auth`, `@DiscordEventListener` |
| **Transaction** | 1κ° | `@Transactional` |
| **JSON** | 1κ° | `@JsonProperty` |

---

## π’΅ **μ‹¤μ  μ‚¬μ© μμ‹**

### 1. Entity μ •μ
```kotlin
@Entity
@Table(name = "khlug_members")
data class Member(
    @Id
    val id: Long,
    
    @Column(name = "name", unique = true, nullable = false, length = 127)
    val name: String,
    
    @Convert(converter = StudentStatusConverter::class)
    val studentStatus: StudentStatus,
    
    @CreationTimestamp
    @Column(name = "created_at", nullable = false)
    val createdAt: LocalDateTime = LocalDateTime.now(),
)
```

### 2. Repository μ •μ
```kotlin
@Repository
interface MemberRepository : JpaRepository<Member, Long>
```

### 3. Service μ •μ
```kotlin
@Service
class UserService(
    private val memberRepository: MemberRepository,
) {
    @Transactional(readOnly = true)
    fun getMemberById(userId: Long): Member {
        return memberRepository.findById(userId).orElseThrow {
            NotFoundException("μ‚¬μ©μλ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤")
        }
    }
}
```

### 4. Controller μ •μ
```kotlin
@RestController
class UserController(
    private val userService: UserService,
) {
    @Auth([UserRole.USER, UserRole.MANAGER])
    @GetMapping("/users/@me")
    fun getCurrentUser(requester: Requester): GetCurrentUserResponse {
        val member = userService.getMemberById(requester.userId)
        return GetCurrentUserResponse(...)
    }
    
    @Auth([UserRole.MANAGER])
    @PostMapping("/users")
    @ResponseStatus(HttpStatus.CREATED)
    fun createUser(
        @Valid @RequestBody request: CreateUserRequest,
    ): CreateUserResponse {
        // ...
    }
}
```

### 5. DTO μ •μ
```kotlin
data class CreateUserRequest(
    @field:NotBlank(message = "μ΄λ¦„μ€ ν•„μμ…λ‹λ‹¤")
    @field:JsonProperty("userName")
    val userName: String,
    
    @field:Min(value = 1, message = "λ‚μ΄λ” 1 μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤")
    @field:JsonProperty("age")
    val age: Int,
)
```

### 6. μμ™Έ μ²λ¦¬
```kotlin
@ControllerAdvice
class GlobalExceptionHandler {
    @ExceptionHandler(BaseException::class)
    fun handleBaseException(e: BaseException): ResponseEntity<ErrorResponse> {
        val errorResponse = ErrorResponse(
            statusCode = e.statusCode.value(),
            message = e.message,
            data = e.data,
            timestamp = Instant.now().toEpochMilli(),
        )
        return ResponseEntity.status(e.statusCode).body(errorResponse)
    }
}
```

### 7. μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ… μ •μ
```kotlin
@Target(AnnotationTarget.FUNCTION, AnnotationTarget.CLASS)
@Retention(AnnotationRetention.RUNTIME)
annotation class Auth(val roles: Array<UserRole>)
```

### 8. AOPλ΅ μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ… μ²λ¦¬
```kotlin
@Aspect
@Component
class AuthAspect {
    @Around("@annotation(auth)")
    fun checkAuth(
        joinPoint: ProceedingJoinPoint,
        auth: Auth,
    ): Any? {
        val requester = AuthenticationHelper.getCurrentRequester()
            ?: throw UnauthorizedException("μΈμ¦μ΄ ν•„μ”ν•©λ‹λ‹¤")
        
        if (!auth.roles.contains(requester.role)) {
            throw ForbiddenException("κ¶ν•μ΄ λ¶€μ΅±ν•©λ‹λ‹¤")
        }
        
        return joinPoint.proceed()
    }
}
```

---

## π”‘ **ν•µμ‹¬ κ°λ… μ •λ¦¬**

### Validation μ–΄λ…Έν…μ΄μ… λΉ„κµ

| μ–΄λ…Έν…μ΄μ… | null μ²΄ν¬ | λΉ λ¬Έμμ—΄ (`""`) μ²΄ν¬ | κ³µλ°± λ¬Έμμ—΄ (`"   "`) μ²΄ν¬ |
|-----------|----------|---------------------|------------------------|
| `@NotNull` | β… | β | β |
| `@NotEmpty` | β… | β… | β |
| `@NotBlank` | β… | β… | β… |

**π’΅ κ²°λ΅ **: λ¬Έμμ—΄ κ²€μ¦μ—λ” `@NotBlank`κ°€ κ°€μ¥ μ—„κ²©ν•κ³  μ•μ „!

### HTTP λ©”μ„λ“ λ§¤ν•‘

| μ–΄λ…Έν…μ΄μ… | HTTP λ©”μ„λ“ | μ©λ„ |
|-----------|------------|------|
| `@GetMapping` | GET | λ¦¬μ†μ¤ μ΅°ν |
| `@PostMapping` | POST | λ¦¬μ†μ¤ μƒμ„± |
| `@PutMapping` | PUT | λ¦¬μ†μ¤ μ „μ²΄ μμ • |
| `@PatchMapping` | PATCH | λ¦¬μ†μ¤ λ¶€λ¶„ μμ • |
| `@DeleteMapping` | DELETE | λ¦¬μ†μ¤ μ‚­μ  |

### Spring μ¤ν…λ μ¤νƒ€μ… μ–΄λ…Έν…μ΄μ…

```
      @Component (λ²”μ©)
           β†‘
    β”β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”
    β”‚      β”‚      β”‚
@Service @Repository @Controller
(λΉ„μ¦λ‹μ¤) (λ°μ΄ν„°)  (μ›Ή κ³„μΈµ)
```

λ¨λ‘ `@Component`μ νΉμν™”λ ν•νƒμ§€λ§, **μλ―Έλ΅ μ  μ—­ν• **μ„ λ…ν™•ν ν•κΈ° μ„ν•΄ κµ¬λ¶„ν•΄μ„ μ‚¬μ©!

---

## π“ μ°Έκ³  λ§ν¬

- **Spring Framework κ³µμ‹ λ¬Έμ„**: https://spring.io/projects/spring-framework
- **Spring Boot κ³µμ‹ λ¬Έμ„**: https://spring.io/projects/spring-boot
- **Jakarta Persistence (JPA)**: https://jakarta.ee/specifications/persistence/
- **Hibernate κ³µμ‹ λ¬Έμ„**: https://hibernate.org/orm/documentation/

---

## π“ ν•™μµ ν

1. **κ³„μΈµλ³„λ΅ μ΄ν•΄ν•κΈ°**: Controller β†’ Service β†’ Repository β†’ Entity μμ„λ΅ ν•™μµ
2. **μ‹¤μ „μ—μ„ λ°°μ°κΈ°**: κΈ°μ΅΄ μ½”λ“λ¥Ό μ½μΌλ©΄μ„ μ–΄λ…Έν…μ΄μ…μ μ“°μ„μƒ νμ•…
3. **λ¬Έμ„ ν™μ©ν•κΈ°**: IntelliJμ—μ„ `Ctrl + Q` (Windows) / `F1` (Mac)λ΅ μ–΄λ…Έν…μ΄μ… λ¬Έμ„ ν™•μΈ

---

κ¶κΈν• μ–΄λ…Έν…μ΄μ…μ΄ λ” μκ±°λ‚, νΉμ • μ–΄λ…Έν…μ΄μ…μ— λ€ν•΄ λ” μμ„Έν μ•κ³  μ‹¶μΌμ‹λ©΄ μ–Έμ λ“  λ¬Όμ–΄λ³΄μ„Έμ”! π€
